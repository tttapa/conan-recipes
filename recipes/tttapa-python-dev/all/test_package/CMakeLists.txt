cmake_minimum_required(VERSION 3.26)
project(PackageTest)

set(PYTHON_DEV_PACKAGE_FOLDER "" CACHE PATH "")
set(PYTHON_DEV_VERSION "" CACHE STRING "")
set(PYTHON_DEV_LIB_EXT "" CACHE STRING "")
option(PYTHON_DEV_WITH_BIN "option with_bin" Off)

if (PYTHON_DEV_WITH_BIN)
    find_package(Python REQUIRED COMPONENTS
                 Development.Module Development.SABIModule Development.Embed)
    set(Py "python${Python_VERSION_MAJOR}.${Python_VERSION_MINOR}")
    if (NOT Python_VERSION VERSION_EQUAL PYTHON_DEV_VERSION)
        message(SEND_ERROR "Incorrect version: ${Python_VERSION}")
    endif()
    if (NOT Python_INCLUDE_DIRS STREQUAL "${PYTHON_DEV_PACKAGE_FOLDER}/usr/include/${Py}")
        message(SEND_ERROR "Incorrect include directory: ${Python_INCLUDE_DIRS}")
    endif()
    if (NOT Python_LIBRARIES STREQUAL "${PYTHON_DEV_PACKAGE_FOLDER}/usr/lib/lib${Py}.${PYTHON_DEV_LIB_EXT}")
        message(SEND_ERROR "Incorrect libraries: ${Python_LIBRARIES}")
    endif()
    if (NOT Python_SOABI)
        message(SEND_ERROR "Incorrect SOABI")
    endif()
    if (NOT Python_SOSABI)
        message(SEND_ERROR "Incorrect SOSABI")
    endif()
else()
    find_package(Python REQUIRED COMPONENTS
                 Development.Module Development.SABIModule)
    set(Py "python${Python_VERSION_MAJOR}.${Python_VERSION_MINOR}")
    if (NOT Python_VERSION VERSION_EQUAL PYTHON_DEV_VERSION)
        message(SEND_ERROR "Incorrect version: ${Python_VERSION}")
    endif()
    if (NOT Python_INCLUDE_DIRS STREQUAL "${PYTHON_DEV_PACKAGE_FOLDER}/usr/include/${Py}")
        message(SEND_ERROR "Incorrect include directory: ${Python_INCLUDE_DIRS}")
    endif()
    if (Python_LIBRARIES)
        message(SEND_ERROR "Incorrect libraries: ${Python_LIBRARIES}")
    endif()
    if (NOT Python_SOABI)
        message(SEND_ERROR "Incorrect SOABI")
    endif()
    if (NOT Python_SOSABI)
        message(SEND_ERROR "Incorrect SOSABI")
    endif()
endif()
